<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sam CloudboX Launchpad</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background: #0d1117;
      color: #e5e7eb;
      min-height: 100vh;
      padding: 24px;
    }
    
    /* Header */
    .header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 24px;
    }
    .logo {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, #ec4899, #f97316);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 20px rgba(236, 72, 153, 0.3);
    }
    .logo svg {
      width: 24px;
      height: 24px;
      color: white;
    }
    .header-text h1 {
      font-size: 24px;
      font-weight: 700;
      color: #fff;
    }
    .header-text p {
      font-size: 13px;
      color: #6b7280;
    }
    
    /* Top Section - Player & Downloads */
    .top-section {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 16px;
      margin-bottom: 24px;
    }
    
    /* Radio Player */
    .player-card {
      background: #161b22;
      border: 1px solid #30363d;
      border-radius: 14px;
      padding: 16px;
      display: flex;
      align-items: center;
      gap: 16px;
    }
    .play-btn {
      width: 48px;
      height: 48px;
      background: linear-gradient(135deg, #ec4899, #be185d);
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.2s;
      box-shadow: 0 4px 15px rgba(236, 72, 153, 0.4);
    }
    .play-btn:hover { transform: scale(1.05); }
    .play-btn svg { width: 20px; height: 20px; color: white; }
    .album-art {
      width: 56px;
      height: 56px;
      border-radius: 8px;
      object-fit: cover;
      background: #21262d;
    }
    .track-info {
      flex: 1;
      min-width: 0;
    }
    .track-title {
      font-weight: 600;
      font-size: 14px;
      color: #fff;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .track-artist {
      font-size: 12px;
      color: #8b949e;
      margin-top: 2px;
    }
    .progress-container {
      margin-top: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .progress-bar {
      flex: 1;
      height: 4px;
      background: #30363d;
      border-radius: 2px;
      overflow: hidden;
    }
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #ec4899, #f472b6);
      transition: width 1s linear;
    }
    .progress-time {
      font-size: 11px;
      color: #6b7280;
    }
    .listeners {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      color: #8b949e;
    }
    
    /* Download Card */
    .download-card {
      background: #161b22;
      border: 1px solid #30363d;
      border-radius: 14px;
      padding: 16px;
    }
    .download-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }
    .download-title {
      font-weight: 600;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .download-title svg { color: #ec4899; }
    .pulse-icon {
      width: 16px;
      height: 16px;
      color: #ec4899;
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    .download-stats {
      font-size: 13px;
    }
    .stat-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 6px;
    }
    .stat-label { color: #6b7280; }
    .stat-value { color: #fff; }
    .download-speed { color: #10b981; }
    .upload-speed { color: #3b82f6; }
    .no-downloads {
      color: #6b7280;
      font-size: 13px;
    }
    
    /* App Grid */
    .app-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 12px;
    }
    
    /* App Card (from your code) */
    .app-card {
      position: relative;
      display: flex;
      align-items: center;
      gap: 12px;
      background: #0f1115;
      border: 1px solid #1f2937;
      border-radius: 14px;
      padding: 12px 14px;
      text-decoration: none;
      color: #e5e7eb;
      font: 500 13px/1.3 Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      box-shadow: 0 10px 24px rgba(0,0,0,.25);
      transition: border-color .2s, box-shadow .2s;
    }
    .app-card::after {
      content: "";
      position: absolute;
      inset: -1px;
      border-radius: 14px;
      pointer-events: none;
      box-shadow: 0 0 0 1px rgba(34,211,238,.30), 0 8px 24px rgba(0,0,0,.35);
      opacity: 0;
      transition: opacity .18s ease-out;
    }
    .app-card:hover { border-color: #0891b2; }
    .app-card:hover::after { opacity: 1; }
    .icon-wrap {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      overflow: hidden;
      background: #111827;
      border: 1px solid #1f2937;
      flex: 0 0 40px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .icon-wrap img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    .meta {
      display: flex;
      flex-direction: column;
      gap: 2px;
      min-width: 0;
    }
    .app-title {
      font-weight: 700;
      letter-spacing: .2px;
      color: #e5e7eb;
    }
    .app-subtitle {
      font-weight: 500;
      font-size: 12px;
      color: #94a3b8;
    }
    .status-dot {
      width: 9px;
      height: 9px;
      border-radius: 50%;
      background: #475569;
      box-shadow: 0 0 0 2px rgba(2,6,23,.6);
      position: absolute;
      right: 12px;
      top: 12px;
      transition: background 0.3s, box-shadow 0.3s;
    }
    .status-dot.online {
      background: #10b981;
      box-shadow: 0 0 0 2px rgba(16,185,129,.25), 0 0 16px rgba(16,185,129,.35);
    }
    .status-dot.offline {
      background: #ef4444;
      box-shadow: 0 0 0 2px rgba(239,68,68,.25), 0 0 14px rgba(239,68,68,.30);
    }
    
    /* Footer */
    .footer {
      margin-top: 40px;
      text-align: center;
      font-size: 12px;
      color: #6b7280;
    }
    
    /* Letterboxd Section */
    .letterboxd-section {
      margin-top: 40px;
      background: #161b22;
      border: 1px solid #30363d;
      border-radius: 14px;
      padding: 20px;
    }
    .letterboxd-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
    }
    .letterboxd-logo {
      width: 32px;
      height: 32px;
      color: #ff8000;
    }
    .letterboxd-title {
      font-size: 18px;
      font-weight: 700;
      color: #fff;
    }
    .letterboxd-subtitle {
      font-size: 13px;
      color: #6b7280;
    }
    .letterboxd-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 16px;
    }
    .letterboxd-movie {
      display: flex;
      gap: 12px;
      background: #0f1115;
      border: 1px solid #1f2937;
      border-radius: 12px;
      padding: 12px;
      transition: border-color 0.2s;
    }
    .letterboxd-movie:hover {
      border-color: #ff8000;
    }
    .letterboxd-poster {
      width: 60px;
      height: 90px;
      border-radius: 6px;
      object-fit: cover;
      background: #21262d;
    }
    .letterboxd-info {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    .letterboxd-movie-title {
      font-weight: 600;
      font-size: 14px;
      color: #fff;
      margin-bottom: 4px;
    }
    .letterboxd-movie-year {
      font-size: 12px;
      color: #6b7280;
      margin-bottom: 8px;
    }
    .letterboxd-rating {
      color: #10b981;
      font-size: 14px;
    }
    .letterboxd-review {
      font-size: 12px;
      color: #94a3b8;
      margin-top: 4px;
      font-style: italic;
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
    }
    .loading {
      color: #6b7280;
      text-align: center;
      padding: 20px;
    }
    
    /* Trakt.tv Section */
    .trakt-section {
      margin-top: 40px;
      background: #161b22;
      border: 1px solid #30363d;
      border-radius: 14px;
      padding: 20px;
    }
    .trakt-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
    }
    .trakt-logo {
      width: 32px;
      height: 32px;
      color: #ed1c24;
    }
    .trakt-title {
      font-size: 18px;
      font-weight: 700;
      color: #fff;
    }
    .trakt-subtitle {
      font-size: 13px;
      color: #6b7280;
    }
    .trakt-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 16px;
    }
    .trakt-item {
      display: flex;
      gap: 10px;
      background: #0f1115;
      border: 1px solid #1f2937;
      border-radius: 10px;
      padding: 10px;
      transition: border-color 0.2s;
      text-decoration: none;
      color: inherit;
    }
    .trakt-item:hover {
      border-color: #ed1c24;
    }
    .trakt-poster {
      width: 50px;
      height: 75px;
      border-radius: 5px;
      object-fit: cover;
      background: #21262d;
    }
    .trakt-info {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    .trakt-show-title {
      font-weight: 600;
      font-size: 12px;
      color: #fff;
      margin-bottom: 2px;
    }
    .trakt-episode-title {
      font-size: 11px;
      color: #94a3b8;
      margin-bottom: 2px;
    }
    .trakt-meta {
      font-size: 10px;
      color: #6b7280;
      margin-bottom: 4px;
    }
    .trakt-watched {
      font-size: 10px;
      color: #ed1c24;
    }
    
    /* IMDb Recently Rated Section */
    .imdb-section {
      margin-top: 40px;
      background: #161b22;
      border: 1px solid #30363d;
      border-radius: 14px;
      padding: 20px;
    }
    .imdb-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
    }
    .imdb-logo {
      width: 32px;
      height: 32px;
      color: #f5c518;
    }
    .imdb-title {
      font-size: 18px;
      font-weight: 700;
      color: #fff;
    }
    .imdb-subtitle {
      font-size: 13px;
      color: #6b7280;
    }
    .imdb-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 16px;
    }
    .imdb-movie {
      display: flex;
      flex-direction: column;
      background: #0f1115;
      border: 1px solid #1f2937;
      border-radius: 10px;
      overflow: hidden;
      transition: border-color 0.2s;
      text-decoration: none;
      color: inherit;
      height: 100%;
    }
    .imdb-movie:hover {
      border-color: #f5c518;
    }
    .imdb-poster {
      width: 100%;
      aspect-ratio: 2/3;
      object-fit: cover;
      background: #21262d;
      display: block;
    }
    .imdb-info {
      padding: 10px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .imdb-movie-title {
      font-weight: 600;
      font-size: 12px;
      color: #fff;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .imdb-movie-year {
      font-size: 10px;
      color: #6b7280;
    }
    .imdb-rating {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 12px;
      color: #f5c518;
      font-weight: 600;
    }
    .imdb-rating-star {
      color: #f5c518;
    }
    .imdb-rated-date {
      font-size: 10px;
      color: #6b7280;
      margin-top: 2px;
    }
    
    @media (max-width: 768px) {
      .top-section { grid-template-columns: 1fr; }
      .app-grid { grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="header">
    <div class="logo">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z" />
      </svg>
    </div>
    <div class="header-text">
      <h1>Sam CloudboX Launchpad</h1>
      <p>Rapid Automation Media Engineer</p>
    </div>
  </div>

  <!-- Top Section: Radio Player & Downloads -->
  <div class="top-section">
    <!-- Radio Player -->
    <div class="player-card">
      <button class="play-btn" id="playBtn">
        <svg id="playIcon" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24">
          <path d="M8 5v14l11-7z"/>
        </svg>
        <svg id="pauseIcon" style="display:none" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24">
          <path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/>
        </svg>
      </button>
      <img id="albumArt" class="album-art" src="" alt="Album Art">
      <div class="track-info">
        <div class="track-title" id="trackTitle">Loading...</div>
        <div class="track-artist" id="trackArtist">-</div>
        <div class="progress-container">
          <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width: 0%"></div>
          </div>
          <span class="progress-time" id="remainingTime">0:00</span>
        </div>
      </div>
      <div class="listeners">
        <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"/>
        </svg>
        <span id="listenerCount">0</span>
      </div>
    </div>

    <!-- Download Monitor -->
    <div class="download-card">
      <div class="download-header">
        <div class="download-title">
          <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
          </svg>
          Now Downloading
        </div>
        <svg class="pulse-icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
        </svg>
      </div>
      <div id="downloadStats" class="no-downloads">Nothing downloading</div>
    </div>
  </div>

  <!-- App Grid -->
  <div class="app-grid" id="appGrid"></div>

  <!-- IMDb Recently Rated -->
  <div class="imdb-section">
    <div class="imdb-header">
      <svg class="imdb-logo" viewBox="0 0 24 24" fill="currentColor">
        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/>
        <path d="M7 7h3v10H7zm5 0h3l2 10h-3l-1.5-7-1.5 7H10z"/>
      </svg>
      <div>
        <h3 class="imdb-title">Recently Rated</h3>
        <p class="imdb-subtitle">from IMDb</p>
      </div>
    </div>
    <div id="imdb-feed" class="imdb-grid">
      <div class="loading">Loading...</div>
    </div>
  </div>

  <!-- Trakt.tv Recently Watched -->
  <div class="trakt-section">
    <div class="trakt-header">
      <svg class="trakt-logo" viewBox="0 0 24 24" fill="currentColor">
        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 14.5v-9l6 4.5-6 4.5z"/>
      </svg>
      <div>
        <h3 class="trakt-title">Recently Watched</h3>
        <p class="trakt-subtitle">from Trakt.tv</p>
      </div>
    </div>
    <div id="trakt-feed" class="trakt-grid">
      <div class="loading">Loading...</div>
    </div>
  </div>

  <!-- Letterboxd Recently Watched -->
  <div class="letterboxd-section">
    <div class="letterboxd-header">
      <svg class="letterboxd-logo" viewBox="0 0 24 24" fill="currentColor">
        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/>
        <circle cx="12" cy="12" r="3"/>
      </svg>
      <div>
        <h3 class="letterboxd-title">Recently Watched</h3>
        <p class="letterboxd-subtitle">From Letterboxd</p>
      </div>
    </div>
    <div id="letterboxd-feed" class="letterboxd-grid">
      <div class="loading">Loading...</div>
    </div>
  </div>

  <!-- Footer -->
  <div class="footer">
    Ramen Launchpad • Sam CloudboX • 2026
  </div>

  <script src="config.js"></script>
  <script>
    // App configurations
    const APPS = [
      { id: 'mv', name: 'Movies', subtitle: 'Sam CloudboX', url: 'https://movies.sam9scloud.in', icon: 'https://i.ibb.co/QjCMrYXt/movie-widget-icon.webp' },
      { id: 'jstat', name: 'Movie Stats', subtitle: 'Sam CloudboX', url: 'https://jellystat.sam9scloud.in/', icon: 'https://i.ibb.co/JFz5H83c/jellystat.webp' },
      { id: 'music', name: 'Music', subtitle: 'Sam CloudboX', url: 'https://music.sam9scloud.in/', icon: 'https://i.ibb.co/DgQ8r3gr/default-art.png' },
      { id: 'photos', name: 'Photos', subtitle: 'Sam CloudboX', url: 'https://photos.sam9scloud.in/', icon: 'https://i.ibb.co/60ByFsR4/Immich-Streamline-Simple-Icons.png' },
      { id: 'abs', name: 'Audiobooks', subtitle: 'Sam CloudboX', url: 'https://abs.sam9scloud.in/', icon: 'https://i.ibb.co/Y48gdbrN/heres-all-you-need-to-know-about-audiobooks.webp' },
      { id: 'eb', name: 'e-Books', subtitle: 'Sam CloudboX', url: 'https://reader.sam9scloud.in/', icon: 'https://i.ibb.co/ynGg1sdQ/ebooks.webp' },
      { id: 'hbx', name: 'Home Inventory', subtitle: 'Sam CloudboX', url: 'https://homebox.sam9scloud.in/', icon: 'https://i.ibb.co/2Y59DbCj/homebox.webp' },
      { id: 'radio', name: 'Radio Requests', subtitle: 'Sam CloudboX', url: 'https://radio.sam9scloud.in/public/sam9s.radio', icon: 'https://i.ibb.co/1GTMhRdc/Pngtree-isolated-live-radio-icon-on-12730106.webp' },
      { id: 'dl', name: 'Downloads', subtitle: 'Sam CloudboX', url: 'https://downloads.sam9scloud.in/', icon: 'https://i.ibb.co/JwVY5XX0/downloads.webp' },
      { id: 'fb', name: 'File Browser', subtitle: 'Sam CloudboX', url: 'https://files.sam9scloud.in/', icon: 'https://i.ibb.co/SwJGfhC0/file-browser.webp' },
      { id: 'paperless', name: 'Documents', subtitle: 'Sam CloudboX', url: 'https://docs.sam9scloud.in/', icon: 'https://i.ibb.co/5XC6wW4b/paperless.png' },
    ];

    // Create app cards
    const grid = document.getElementById('appGrid');
    APPS.forEach(app => {
      const card = document.createElement('a');
      card.className = 'app-card';
      card.href = app.url;
      card.target = '_blank';
      card.rel = 'noopener noreferrer';
      card.innerHTML = `
        <div class="icon-wrap">
          <img id="icon-${app.id}" alt="${app.name} icon" src="${app.icon}">
        </div>
        <div class="meta">
          <div class="app-title">${app.name}</div>
          <div class="app-subtitle">${app.subtitle}</div>
        </div>
        <span id="dot-${app.id}" class="status-dot"></span>
      `;
      grid.appendChild(card);
    });

    // Health check function (from your code)
    async function pingURL(u, dotId) {
      const dot = document.getElementById(dotId);
      const ctl = new AbortController();
      const timer = setTimeout(() => {
        try { ctl.abort(); } catch {}
        setDown(dot);
      }, 2800);

      function setUp(d) {
        d.classList.add('online');
        d.classList.remove('offline');
      }
      function setDown(d) {
        d.classList.add('offline');
        d.classList.remove('online');
      }

      try {
        const url = u + (u.includes('?') ? '&' : '?') + 'v=' + Date.now();
        await fetch(url, { method: 'GET', mode: 'no-cors', cache: 'no-store', signal: ctl.signal });
        clearTimeout(timer);
        setUp(dot);
      } catch {
        clearTimeout(timer);
        setDown(dot);
      }
    }

    // Start health checks
    APPS.forEach(app => {
      pingURL(app.url, `dot-${app.id}`);
      setInterval(() => pingURL(app.url, `dot-${app.id}`), 2000);
    });

    // Radio Player
    let audio = null;
    let isPlaying = false;
    const playBtn = document.getElementById('playBtn');
    const playIcon = document.getElementById('playIcon');
    const pauseIcon = document.getElementById('pauseIcon');

    playBtn.addEventListener('click', () => {
      if (!audio) {
        audio = new Audio('https://radio.sam9scloud.in/listen/sam9s.radio/radio.mp3');
      }
      if (isPlaying) {
        audio.pause();
        playIcon.style.display = 'block';
        pauseIcon.style.display = 'none';
      } else {
        audio.play().catch(console.error);
        playIcon.style.display = 'none';
        pauseIcon.style.display = 'block';
      }
      isPlaying = !isPlaying;
    });

    // Fetch Now Playing
    async function fetchNowPlaying() {
      try {
        const response = await fetch('https://radio.sam9scloud.in/api/nowplaying');
        const data = await response.json();
        if (data && data[0]) {
          const station = data[0];
          document.getElementById('trackTitle').textContent = station.now_playing?.song?.title || 'Unknown';
          document.getElementById('trackArtist').textContent = station.now_playing?.song?.artist || '-';
          document.getElementById('albumArt').src = station.now_playing?.song?.art || '';
          document.getElementById('listenerCount').textContent = station.listeners?.current || 0;
          
          if (station.now_playing) {
            const percent = (station.now_playing.elapsed / station.now_playing.duration) * 100;
            document.getElementById('progressFill').style.width = percent + '%';
            const mins = Math.floor(station.now_playing.remaining / 60);
            const secs = station.now_playing.remaining % 60;
            document.getElementById('remainingTime').textContent = `-${mins}:${secs.toString().padStart(2, '0')}`;
          }
        }
      } catch (error) {
        console.error('Failed to fetch now playing:', error);
      }
    }

    fetchNowPlaying();
    setInterval(fetchNowPlaying, 10000);

    // Fetch Download Stats
    async function fetchDownloads() {
      try {
        const response = await fetch('/api/qbittorrent/stats');
        const data = await response.json();
        const dlSpeed = data.speeds?.dl || 0;
        const ulSpeed = data.speeds?.ul || 0;
        const torrents = data.torrents || [];
        const active = torrents.filter(t => t.state === 'downloading').length;
        
        const statsDiv = document.getElementById('downloadStats');
        if (active > 0 || dlSpeed > 0) {
          statsDiv.innerHTML = `
            <div class="stat-row"><span class="stat-label">Active:</span><span class="stat-value">${active} / ${torrents.length}</span></div>
            <div class="stat-row"><span class="stat-label">Download:</span><span class="stat-value download-speed">${formatSpeed(dlSpeed)}</span></div>
            <div class="stat-row"><span class="stat-label">Upload:</span><span class="stat-value upload-speed">${formatSpeed(ulSpeed)}</span></div>
          `;
          statsDiv.className = 'download-stats';
        } else {
          statsDiv.innerHTML = 'Nothing downloading';
          statsDiv.className = 'no-downloads';
        }
      } catch (error) {
        console.error('Failed to fetch downloads:', error);
      }
    }

    function formatSpeed(bytes) {
      if (bytes === 0) return '0 B/s';
      const k = 1024;
      const sizes = ['B/s', 'KB/s', 'MB/s', 'GB/s'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    fetchDownloads();
    setInterval(fetchDownloads, 30000);

    // Fetch Letterboxd RSS Feed
    async function fetchLetterboxd() {
      try {
        // Using a CORS proxy to fetch the RSS feed
        const response = await fetch('https://api.rss2json.com/v1/api.json?rss_url=https://letterboxd.com/sam9s/rss/');
        const data = await response.json();
        
        if (data.status === 'ok' && data.items) {
          const feedContainer = document.getElementById('letterboxd-feed');
          feedContainer.innerHTML = '';
          
          // Display up to 6 recent movies
          data.items.slice(0, 6).forEach(item => {
            // Extract movie info from title (e.g., "The Terminator, 1984 - ★★★★★")
            const titleMatch = item.title.match(/^(.+?),\s*(\d{4})\s*-\s*(.+)$/);
            const movieTitle = titleMatch ? titleMatch[1] : item.title;
            const movieYear = titleMatch ? titleMatch[2] : '';
            const rating = titleMatch ? titleMatch[3] : '';
            
            // Extract poster from description
            const posterMatch = item.description.match(/src="([^"]+)"/);
            const posterUrl = posterMatch ? posterMatch[1] : '';
            
            // Extract review text (remove HTML tags)
            const reviewText = item.description.replace(/<[^>]*>/g, '').trim();
            
            const movieCard = document.createElement('a');
            movieCard.className = 'letterboxd-movie';
            movieCard.href = item.link;
            movieCard.target = '_blank';
            movieCard.rel = 'noopener noreferrer';
            movieCard.innerHTML = `
              <img class="letterboxd-poster" src="${posterUrl}" alt="${movieTitle}" onerror="this.style.display='none'">
              <div class="letterboxd-info">
                <div class="letterboxd-movie-title">${movieTitle}</div>
                <div class="letterboxd-movie-year">${movieYear}</div>
                <div class="letterboxd-rating">${rating}</div>
                ${reviewText ? `<div class="letterboxd-review">${reviewText}</div>` : ''}
              </div>
            `;
            feedContainer.appendChild(movieCard);
          });
        }
      } catch (error) {
        console.error('Failed to fetch Letterboxd:', error);
        document.getElementById('letterboxd-feed').innerHTML = '<div class="loading">Unable to load Letterboxd feed</div>';
      }
    }

    fetchLetterboxd();
    // Refresh every 30 minutes
    setInterval(fetchLetterboxd, 30 * 60 * 1000);

    // Fetch Trakt.tv Recently Watched
    async function fetchTrakt() {
      try {
        const response = await fetch('recently_watched.json');
        const data = await response.json();
        
        const feedContainer = document.getElementById('trakt-feed');
        feedContainer.innerHTML = '';
        
        // Display up to 4 recent items
        const items = data.slice(0, 4);
        
        for (const item of items) {
          const isEpisode = item.type === 'episode';
          const title = isEpisode ? item.show.title : item.movie.title;
          const year = isEpisode ? item.show.year : item.movie.year;
          const imdbId = isEpisode ? item.episode.ids.imdb : item.movie.ids.imdb;
          const tmdbId = isEpisode ? item.show.ids.tmdb : item.movie.ids.tmdb;
          const imdbUrl = `https://www.imdb.com/title/${imdbId}`;
          
          let subtitle = '';
          let meta = '';
          
          if (isEpisode) {
            subtitle = item.episode.title;
            meta = `S${item.episode.season}E${item.episode.number} • ${year}`;
          } else {
            meta = year;
          }
          
          // Format watched time
          const watchedDate = new Date(item.watched_at);
          const timeAgo = formatTimeAgo(watchedDate);
          
          // Get image URL from TMDB (using CONFIG)
          const imageUrl = window.CONFIG?.TMDB_API_KEY && window.CONFIG.TMDB_API_KEY !== '__TMDB_API_KEY__'
            ? await getTmdbImage(isEpisode, tmdbId, item.episode?.season, item.episode?.number)
            : '';
          
          const card = document.createElement('a');
          card.className = 'trakt-item';
          card.href = imdbUrl;
          card.target = '_blank';
          card.rel = 'noopener noreferrer';
          card.innerHTML = `
            <img class="trakt-poster" src="${imageUrl}" alt="${title}" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%2250%22 height=%2275%22><rect width=%2250%22 height=%2275%22 fill=%22%2321262d%22/><text x=%2225%22 y=%2240%22 text-anchor=%22middle%22 fill=%22%23ed1c24%22 font-size=%2220%22>▶</text></svg>'">
            <div class="trakt-info">
              <div class="trakt-show-title">${title}</div>
              ${subtitle ? `<div class="trakt-episode-title">${subtitle}</div>` : ''}
              <div class="trakt-meta">${meta}</div>
              <div class="trakt-watched">${timeAgo}</div>
            </div>
          `;
          feedContainer.appendChild(card);
        }
      } catch (error) {
        console.error('Failed to fetch Trakt:', error);
        document.getElementById('trakt-feed').innerHTML = '<div class="loading">Unable to load Trakt history</div>';
      }
    }
    
    async function getTmdbImage(isEpisode, tmdbId, season, episode) {
      if (!tmdbId || !window.CONFIG?.TMDB_API_KEY || window.CONFIG.TMDB_API_KEY === '__TMDB_API_KEY__') return '';
      
      try {
        if (isEpisode && season && episode) {
          // Try to get episode still image
          const response = await fetch(`https://api.themoviedb.org/3/tv/${tmdbId}/season/${season}/episode/${episode}/images?api_key=${window.CONFIG.TMDB_API_KEY}`);
          const data = await response.json();
          if (data.stills && data.stills.length > 0) {
            return `https://image.tmdb.org/t/p/w300${data.stills[0].file_path}`;
          }
        }
        
        // Fallback to show/movie poster
        const type = isEpisode ? 'tv' : 'movie';
        const response = await fetch(`https://api.themoviedb.org/3/${type}/${tmdbId}/images?api_key=${window.CONFIG.TMDB_API_KEY}`);
        const data = await response.json();
        const posters = data.posters;
        if (posters && posters.length > 0) {
          return `https://image.tmdb.org/t/p/w92${posters[0].file_path}`;
        }
      } catch (e) {
        console.log('Failed to fetch TMDB image:', e);
      }
      return '';
    }
    
    // Fetch IMDb Recently Rated
    async function fetchImdbRated() {
      try {
        const response = await fetch('recently_rated.json');
        const data = await response.json();
        
        const feedContainer = document.getElementById('imdb-feed');
        feedContainer.innerHTML = '';
        
        // Display up to 5 recent rated movies
        const items = data.slice(0, 5);
        
        for (const item of items) {
          const movie = item.movie;
          const imdbId = movie.ids.imdb;
          const tmdbId = movie.ids.tmdb;
          const imdbUrl = `https://www.imdb.com/title/${imdbId}`;
          
          // Format rated time
          const ratedDate = new Date(item.rated_at);
          const timeAgo = formatTimeAgo(ratedDate);
          
          // Get poster from TMDB (using CONFIG)
          const posterUrl = tmdbId && window.CONFIG?.TMDB_API_KEY && window.CONFIG.TMDB_API_KEY !== '__TMDB_API_KEY__'
            ? await getTmdbPoster(tmdbId, 'movie')
            : '';
          
          const card = document.createElement('a');
          card.className = 'imdb-movie';
          card.href = imdbUrl;
          card.target = '_blank';
          card.rel = 'noopener noreferrer';
          card.innerHTML = `
            <img class="imdb-poster" src="${posterUrl}" alt="${movie.title}" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%22180%22 height=%22200%22><rect width=%22180%22 height=%22200%22 fill=%22%2321262d%22/><text x=%2290%22 y=%22100%22 text-anchor=%22middle%22 fill=%22%23f5c518%22 font-size=%2240%22>★</text></svg>'">
            <div class="imdb-info">
              <div class="imdb-movie-title" title="${movie.title}">${movie.title}</div>
              <div class="imdb-movie-year">${movie.year}</div>
              <div class="imdb-rating">
                <span class="imdb-rating-star">★</span>
                <span>${item.rating}/10</span>
              </div>
              <div class="imdb-rated-date">${timeAgo}</div>
            </div>
          `;
          feedContainer.appendChild(card);
        }
      } catch (error) {
        console.error('Failed to fetch IMDb rated:', error);
        document.getElementById('imdb-feed').innerHTML = '<div class="loading">Unable to load IMDb ratings</div>';
      }
    }
    
    async function getTmdbPoster(tmdbId, type) {
      if (!tmdbId || !window.CONFIG?.TMDB_API_KEY || window.CONFIG.TMDB_API_KEY === '__TMDB_API_KEY__') return '';
      
      try {
        const response = await fetch(`https://api.themoviedb.org/3/${type}/${tmdbId}/images?api_key=${window.CONFIG.TMDB_API_KEY}`);
        const data = await response.json();
        const posters = data.posters;
        if (posters && posters.length > 0) {
          return `https://image.tmdb.org/t/p/w185${posters[0].file_path}`;
        }
      } catch (e) {
        console.log('Failed to fetch TMDB poster:', e);
      }
      return '';
    }
    
    function formatTimeAgo(date) {
      const now = new Date();
      const diffMs = now - date;
      const diffMins = Math.floor(diffMs / 60000);
      const diffHours = Math.floor(diffMs / 3600000);
      const diffDays = Math.floor(diffMs / 86400000);
      
      if (diffMins < 60) return `${diffMins}m ago`;
      if (diffHours < 24) return `${diffHours}h ago`;
      if (diffDays < 7) return `${diffDays}d ago`;
      return date.toLocaleDateString();
    }

    // Initialize Trakt and IMDb feeds
    fetchTrakt();
    setInterval(fetchTrakt, 5 * 60 * 1000); // Refresh every 5 minutes
    
    fetchImdbRated();
    setInterval(fetchImdbRated, 10 * 60 * 1000); // Refresh every 10 minutes
  </script>
</body>
</html>